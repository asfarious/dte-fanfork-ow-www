###########################################
#
# Holy Order Decisions for Sons of Abraham
#
###########################################
# Written by Henrik Fåhraeus
###########################################

# Holy Order Decisions are listed for each existing holy order of the right religion

decisions = {

	borrow_money_knights_templar = {
		ai_check_interval = 120

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_knights_templar
			religion = d_knights_templar
			is_nomadic = no

			trigger_if = {
				limit = { ai = yes }

				higher_tier_than = COUNT
				independent = yes
			}

			NOR = {
				has_character_modifier = borrowed_from_knights_templar
				has_character_modifier = expelled_d_knights_templar
				government = order_government
				is_liege_of = d_knights_templar
			}
		}

		allow = {
			d_knights_templar = {
				holder_scope = {
					wealth >= 300
				}
			}

			NOT = { trait = excommunicated }
			piety >= 100

			custom_tooltip = {
				text = knights_templar_loan_money_TT

				reverse_opinion = {
					who = d_knights_templar
					value >= 25
				}
			}
		}

		effect = {
			wealth = 300
			piety = -100

			add_character_modifier = {
				name = borrowed_from_knights_templar
				duration = -1
				inherit = yes
			}

			hidden_effect = {
				d_knights_templar = {
					holder_scope = {
						character_event = {
							id = SoA.1010
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.5

			trigger = {
				wealth < 0
			}
		}
	}

	expel_the_knights_templar = {
		ai = no

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_knights_templar
			independent = yes
			higher_real_tier_than = DUKE
			religion = d_knights_templar
			NOT = { has_character_modifier = expelled_d_knights_templar }

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_knights_templar
						is_vassal_or_below_of = d_knights_templar
					}
				}
			}
		}

		allow = {
			piety >= 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_the_knights_templar_check }
			}
		}

		effect = {
			set_character_flag = expel_the_knights_templar_check

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b
				character_event = { id = SoA.2990 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	expel_the_knights_hospitaler = {
		ai = no

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_knights_hospitaler
			independent = yes
			higher_real_tier_than = DUKE
			religion = d_knights_hospitaler
			NOT = { has_character_modifier = expelled_d_knights_hospitaler }

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_knights_hospitaler
						is_vassal_or_below_of = d_knights_hospitaler
					}
				}
			}
		}

		allow = {
			piety >= 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_the_knights_hospitaler_check }
			}
		}

		effect = {
			set_character_flag = expel_the_knights_hospitaler_check

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b
				character_event = { id = SoA.2990 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	expel_the_teutonic_order = {
		ai = no

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_teutonic_order
			independent = yes
			higher_real_tier_than = DUKE
			religion = d_teutonic_order
			NOT = { has_character_modifier = expelled_d_teutonic_order }

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_teutonic_order
						is_vassal_or_below_of = d_teutonic_order
					}
				}
			}
		}

		allow = {
			piety >= 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_the_teutonic_order_check }
			}
		}

		effect = {
			set_character_flag = expel_the_teutonic_order_check

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b
				character_event = { id = SoA.2990 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	expel_the_jomsvikings = {
		ai = no

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_jomsvikings
			independent = yes
			higher_real_tier_than = DUKE
			religion = d_jomsvikings
			NOT = { has_character_modifier = expelled_d_jomsvikings }

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_jomsvikings
						is_vassal_or_below_of = d_jomsvikings
					}
				}
			}
		}

		allow = {
			piety >= 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_the_jomsvikings_check }
			}
		}

		effect = {
			set_character_flag = expel_the_jomsvikings_check

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b
				character_event = { id = SoA.2990 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	expel_the_assassins = {
		ai = no

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_hashshashin
			independent = yes
			higher_real_tier_than = DUKE
			religion = d_hashshashin

			NOR = {
				has_character_modifier = expelled_d_hashshashin
				society_member_of = the_assassins
			}

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_hashshashin
						is_vassal_or_below_of = d_hashshashin
					}
				}
			}
		}

		allow = {
			piety >= 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_the_assassins_check }
			}
		}

		effect = {
			set_character_flag = expel_the_assassins_check

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b
				character_event = { id = SoA.2990 } # Actual expelling
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	donate_money_to_knights_templar = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_knights_templar
			religion = d_knights_templar

			trigger_if = {
				limit = { ai = yes }

				wealth >= 600

				trigger_if = {
					limit = {
						NOR = {
							trait = zealous
							trait = charitable
						}
					}

					NOT = { trait = cynical }
					piety < 300
				}
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_knights_templar
				is_liege_of = d_knights_templar
			}

			trigger_if = {
				limit = {
					OR = {
						culture_group = iberian
						culture_group = west_african
						culture = maghreb_arabic
						culture = occitan
					}
				}

				NOR = {
					is_title_active = d_knights_calatrava
					is_title_active = d_knights_santiago
				}
			}
			trigger_else_if = {
				limit = {
					OR = {
						culture_group = north_germanic
						culture_group = central_germanic
						culture_group = magyar
						culture_group = south_slavic
						culture_group = west_slavic
					}
				}

				NOR = {
					is_title_active = d_teutonic_order
					is_title_active = k_teutonic_state
				}
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			if = {
				limit = {
					NOT = { has_character_modifier = donated_to_holy_order }
				}

				add_character_modifier = {
					name = donated_to_holy_order
					duration = -1
				}
			}

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_knights_templar = {
					holder_scope = {
						character_event = {
							id = SoA.1140 # Notify
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.5
		}
	}

	donate_money_to_knights_hospitaler = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_knights_hospitaler
			religion = d_knights_hospitaler

			trigger_if = {
				limit = { ai = yes }

				wealth >= 1000
				piety < 50
				NOR = { trait = cynical }
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_knights_hospitaler
				is_liege_of = d_knights_hospitaler
			}

			trigger_if = {
				limit = {
					OR = {
						culture_group = iberian
						culture_group = west_african
						culture = maghreb_arabic
						culture = occitan
					}
				}

				NOR = {
					is_title_active = d_knights_santiago
					is_title_active = d_knights_calatrava
				}
			}
			trigger_else_if = {
				limit = {
					OR = {
						culture_group = north_germanic
						culture_group = central_germanic
						culture_group = magyar
						culture_group = south_slavic
						culture_group = west_slavic
					}
				}

				NOR = {
					is_title_active = d_teutonic_order
					is_title_active = k_teutonic_state
				}
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			if = {
				limit = {
					NOT = { has_character_modifier = donated_to_holy_order }
				}

				add_character_modifier = {
					name = donated_to_holy_order
					duration = -1
				}
			}

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_knights_hospitaler = {
					holder_scope = {
						character_event = {
							id = SoA.1140 # Notify
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.1
		}
	}

	donate_money_to_teutonic_order = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"

			trigger_if = {
				limit = { is_title_active = d_teutonic_order }
				religion = d_teutonic_order
			}
			trigger_else = {
				is_title_active = k_teutonic_state
				religion = k_teutonic_state
			}

			trigger_if = {
				limit = { ai = yes }

				wealth >= 1000
				piety < 50
				NOT = { trait = cynical }
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_teutonic_order
				has_character_modifier = expelled_k_teutonic_state
				is_liege_of = d_teutonic_order
				is_liege_of = k_teutonic_state
			}

			trigger_if = {
				limit = {
					OR = {
						culture_group = iberian
					    culture_group = west_african
					    culture = maghreb_arabic
					    culture = occitan
					}
				}

				NOR = {
					is_title_active = d_knights_santiago
					is_title_active = d_knights_calatrava
				}
			}
			trigger_else_if = {
				limit = {
					NOR = {
						culture_group = north_germanic
						culture_group = central_germanic
						culture_group = magyar
						culture_group = south_slavic
						culture_group = west_slavic
					}
				}

				NOR = {
					is_title_active = d_knights_hospitaler
					is_title_active = d_knights_templar
					is_title_active = d_knights_santiago
					is_title_active = d_knights_calatrava
				}
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			if = {
				limit = {
					NOT = { has_character_modifier = donated_to_holy_order }
				}

				add_character_modifier = {
					name = donated_to_holy_order
					duration = -1
				}
			}

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_teutonic_order = {
					holder_scope = {
						character_event = {
							id = SoA.1340 # Notify
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.1
		}
	}

	donate_money_to_jomsvikings = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_jomsvikings

			OR = {
				religion = d_jomsvikings
				is_heresy_of = d_jomsvikings
			}

			trigger_if = {
				limit = { ai = yes }

				wealth >= 1000
				piety < 50
				NOT = { trait = cynical }
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_jomsvikings
				is_liege_of = d_jomsvikings
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			if = {
				limit = {
					NOT = { has_character_modifier = donated_to_holy_order }
				}

				add_character_modifier = {
					name = donated_to_holy_order
					duration = -1
				}
			}

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_jomsvikings = {
					holder_scope = {
						character_event = {
							id = SoA.1540
						}
					}
				}
			}
		}


		ai_will_do = {
			factor = 0.1
		}
	}

	borrow_money_assassins = {
		ai_check_interval = 120

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_hashshashin
			religion = d_hashshashin
			is_nomadic = no

			trigger_if = {
				limit = { ai = no }

				independent = yes
				higher_tier_than = COUNT
			}

			NOR = {
				has_character_modifier = borrowed_from_assassins
				has_character_modifier = expelled_d_hashshashin
				has_character_modifier = assassins_debt #From MNM.6001
				society_member_of = the_assassins
				government = order_government
				is_liege_of = d_hashshashin
			}
		}

		allow = {
			d_hashshashin = {
				holder_scope = {
					wealth >= 300
				}
			}

			piety >= 100

			custom_tooltip = {
				text = hashshashin_loan_money_TT

				reverse_opinion = {
					who = d_hashshashin
					value >= 25
				}
			}
		}

		effect = {
			wealth = 300
			piety = -100

			add_character_modifier = {
				name = borrowed_from_assassins
				duration = -1
				inherit = yes
			}

			hidden_effect = {
				if = {
					limit = { has_dlc = "Mystics" }

					set_variable = {
						which = assassins_debt
						value = 300
					}
				}

				d_hashshashin = {
					holder_scope = {
						character_event = {
							id = SoA.1410
						}
					}
				}
			}
		}


		ai_will_do = {
			factor = 0.5

			trigger = {
				wealth < 0
			}
		}
	}

	donate_money_to_assassins = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_hashshashin
			religion = d_hashshashin

			trigger_if = {
				limit = { ai = yes }

				wealth >= 1000
				piety < 50
				NOT = { trait = cynical }
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_hashshashin
				society_member_of = the_assassins
				is_liege_of = d_hashshashin
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_hashshashin = {
					holder_scope = {
						character_event = {
							id = SoA.1140
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.1
		}
	}

	borrow_money_bektashi = {
		ai_check_interval = 120

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_bektashi
			religion = d_bektashi
			is_nomadic = no

			trigger_if = {
				limit = { ai = yes }

				independent = yes
				higher_tier_than = COUNT
			}

			NOR = {
				has_character_modifier = borrowed_from_bektashi
				has_character_modifier = expelled_d_bektashi
				government = order_government
				is_liege_of = d_bektashi
			}
		}

		allow = {
			d_bektashi = {
				holder_scope = {
					wealth >= 300
				}
			}

			piety >= 100

			custom_tooltip = {
				text = bektashi_loan_money_TT

				reverse_opinion = {
					who = d_bektashi
					value >= 25
				}
			}
		}

		effect = {
			wealth = 300
			piety = -100

			add_character_modifier = {
				name = borrowed_from_bektashi
				duration = -1
				inherit = yes
			}

			hidden_effect = {
				d_bektashi = {
					holder_scope = {
						character_event = {
							id = SoA.1210
						}
					}
				}
			}
		}


		ai_will_do = {
			factor = 0.5

			trigger = {
				wealth < 0
			}
		}
	}

	donate_money_to_bektashi = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_bektashi
			religion = d_bektashi

			trigger_if = {
				limit = { ai = yes }

				wealth >= 1000
				piety < 50
				NOT = { trait = cynical }
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_bektashi
				is_liege_of = d_bektashi
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_bektashi = {
					holder_scope = {
						character_event = {
							id = SoA.1140
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.1
		}
	}

	expel_the_bektashi = {
		ai = no
		only_independent = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_bektashi
			independent = yes
			higher_tier_than = DUKE
			religion = d_bektashi
			NOT = { has_character_modifier = expelled_d_bektashi }

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_bektashi
						is_vassal_or_below_of = d_bektashi
					}
				}
			}
		}

		allow = {
			piety >= 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_the_bektashi_check }
			}
		}

		effect = {
			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b

				set_character_flag = expel_the_bektashi_check
				character_event = { id = SoA.2990 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	borrow_money_haruriyyah = {
		ai_check_interval = 120

		only_playable = yes

		potential = {
			has_dlc = "Charlemagne"
			is_title_active = d_haruriyyah
			religion = d_haruriyyah
			is_nomadic = no

			trigger_if = {
				limit = { ai = yes }

				independent = yes
				higher_tier_than = COUNT
			}

			NOR = {
				has_character_modifier = borrowed_from_haruriyyah
				has_character_modifier = expelled_d_haruriyyah
				government = order_government
				is_liege_of = d_haruriyyah
			}
		}

		allow = {
			d_haruriyyah = {
				holder_scope = {
					wealth >= 300
				}
			}

			piety >= 100

			custom_tooltip = {
				text = haruriyyah_loan_money_TT

				reverse_opinion = {
					who = d_haruriyyah
					value >= 25
				}
			}
		}

		effect = {
			wealth = 300
			piety = -100

			add_character_modifier = {
				name = borrowed_from_haruriyyah
				duration = -1
				inherit = yes
			}

			hidden_effect = {
				d_haruriyyah = {
					holder_scope = {
						character_event = {
							id = CM.4310
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.5

			trigger = {
				wealth < 0
			}
		}
	}

	donate_money_to_haruriyyah = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Charlemagne"
			is_title_active = d_haruriyyah
			religion  = d_haruriyyah

			trigger_if = {
				limit = { ai = yes }

				wealth >= 1000
				piety < 50
				NOT = { trait = cynical }
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_haruriyyah
				is_liege_of = d_haruriyyah
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_haruriyyah = {
					holder_scope = {
						character_event = {
							id = SoA.1140
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.1
		}
	}

	expel_the_haruriyyah = {
		ai = no

		potential = {
			has_dlc = "Charlemagne"
			is_title_active = d_haruriyyah
			independent = yes
			higher_tier_than = DUKE
			religion = d_haruriyyah
			NOT = { has_character_modifier = expelled_d_haruriyyah }

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_haruriyyah
						is_vassal_or_below_of = d_haruriyyah
					}
				}
			}
		}

		allow = {
			piety >= 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_the_haruriyyah_check }
			}
		}

		effect = {
			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b

				set_character_flag = expel_the_haruriyyah_check
				character_event = { id = SoA.2990 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	vassalize_knights_templar = {
		is_high_prio = yes
		ai_check_interval = 60

		only_playable = yes

		potential = {
			has_landed_title = k_jerusalem
			has_dlc = "Sons of Abraham"
			is_title_active = d_knights_templar
			is_catholic_branch = yes

			NOR = {
				has_character_modifier = expelled_d_knights_templar

				reverse_has_opinion_modifier = {
					who = d_knights_templar
					modifier = opinion_unfit_ruler
				}

				has_alternate_start_parameter = {
					key = religion_names
					value = random
				}
			}

			d_knights_templar = {
				is_primary_holder_title = yes

				holder_scope = {
					independent = yes
					num_of_count_titles < 3

					NOR = {
						vassal_of = ROOT
						has_truce = ROOT
						reverse_has_truce = ROOT
					}
				}
			}
		}

		allow = {
			independent = yes
			is_heretic = no
			NOT = { trait = excommunicated }
			wealth >= 500

			trigger_if = {
				trigger = {
					reverse_opinion = {
						who = d_knights_templar
						value = 25
					}
				}

				custom_tooltip = {
					text = vassalize_knights_templar_opinion_TT

					always = no
				}
			}

			custom_tooltip = {
				text = only_one_vassalized_holy_order_TT

				NOT = {
					any_realm_lord = {
						holy_order = yes
					}
				}
			}
		}

		effect = {
			wealth = -500

			hidden_effect = {
				d_knights_templar = {
					holder_scope = {
						wealth = 500

						character_event = {
							id = SoA.1015
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 1
		}
	}

	vassalize_knights_hospitaler = {
		is_high_prio = yes
		ai_check_interval = 60

		only_playable = yes

		potential = {
			has_landed_title = k_jerusalem
			has_dlc = "Sons of Abraham"
			is_title_active = d_knights_hospitaler
			is_catholic_branch = yes

			NOR = {
				has_character_modifier = expelled_d_knights_hospitaler

				reverse_has_opinion_modifier = {
					who = d_knights_hospitaler
					modifier = opinion_unfit_ruler
				}

				has_alternate_start_parameter = {
					key = religion_names
					value = random
				}
			}

			d_knights_hospitaler = {
				is_primary_holder_title = yes

				holder_scope = {
					independent = yes
					num_of_count_titles < 3

					NOR = {
						has_truce = ROOT
						reverse_has_truce = ROOT
						vassal_of = ROOT
					}
				}
			}
		}

		allow = {
			independent = yes
			is_heretic = no
			NOT = { trait = excommunicated }
			wealth >= 500

			trigger_if = {
				limit = {
					reverse_opinion = {
						who = d_knights_hospitaler
						value < 25
					}
				}

				custom_tooltip = {
					text = vassalize_knights_hospitaller_opinion_TT

					always = no
				}
			}

			custom_tooltip = {
				text = only_one_vassalized_holy_order_TT

				NOT = {
					any_realm_lord = {
						holy_order = yes
					}
				}
			}
		}

		effect = {
			wealth = -500

			hidden_effect = {
				d_knights_hospitaler = {
					holder_scope = {
						wealth = 500

						character_event = {
							id = SoA.1115
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 1
		}
	}

	expel_the_holy_sepulchre = {
		ai = no

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_holy_sepulchre
			independent = yes
			higher_real_tier_than = DUKE
			religion = d_holy_sepulchre
			NOT = { has_character_modifier = expelled_d_holy_sepulchre }

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_holy_sepulchre
						is_vassal_or_below_of = d_holy_sepulchre
					}
				}
			}
		}

		allow = {
			piety >= 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_the_holy_sepulchre_check }
			}
		}

		effect = {
			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b

				set_character_flag = expel_the_holy_sepulchre_check
				character_event = { id = SoA.2990 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	donate_money_to_holy_sepulchre = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_holy_sepulchre
			religion = d_holy_sepulchre

			trigger_if = {
				limit = { ai = yes }

				wealth >= 1000
				piety < 50
				NOT = { trait = cynical }
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_holy_sepulchre
				is_liege_of = d_holy_sepulchre
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			if = {
				limit = {
					NOT = { has_character_modifier = donated_to_holy_order }
				}

				add_character_modifier = {
					name = donated_to_holy_order
					duration = -1
				}
			}

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_holy_sepulchre = {
					holder_scope = {
						character_event = {
							id = SoA.1640
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.1
		}
	}

	expel_saint_anthony = {
		ai = no

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_saint_anthony
			independent = yes
			higher_real_tier_than = DUKE
			religion = d_saint_anthony
			NOT = { has_character_modifier = expelled_d_saint_anthony }

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_saint_anthony
						is_vassal_or_below_of = d_saint_anthony
					}
				}
			}

		}

		allow = {
			piety >= 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_saint_anthony_check }
			}
		}

		effect = {
			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b

				set_character_flag = expel_saint_anthony_check
				character_event = { id = SoA.2990 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	donate_money_to_saint_anthony = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_saint_anthony
			religion = d_saint_anthony

			trigger_if = {
				limit = { ai = yes }

				wealth >= 1000
				piety < 50
				NOT = { trait = cynical }
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_saint_anthony
				is_liege_of = d_saint_anthony
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			if = {
				limit = {
					NOT = { has_character_modifier = donated_to_holy_order }
				}

				add_character_modifier = {
					name = donated_to_holy_order
					duration = -1
				}
			}

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_saint_anthony = {
					holder_scope = {
						character_event = {
							id = SoA.1740
						}
					}
				}
			}
		}


		ai_will_do = {
			factor = 0.1
		}
	}

	expel_immortals = {
		ai = no
		only_independent = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_immortals
			religion = d_immortals
			higher_real_tier_than = DUKE
			NOT = { has_character_modifier = expelled_d_immortals }

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_immortals
						is_vassal_or_below_of = d_immortals
					}
				}
			}
		}

		allow = {
			piety >= 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_immortals_check }
			}
		}

		effect = {
			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b

				set_character_flag = expel_immortals_check
				character_event = { id = SoA.2990 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	donate_money_to_the_immortals = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_immortals
			religion = d_immortals

			trigger_if = {
				limit = { ai = yes }

				wealth > 1000
				piety < 50
				NOT = { trait = cynical }
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_immortals
				is_liege_of = d_immortals
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			if = {
				limit = {
					NOT = { has_character_modifier = donated_to_holy_order }
				}

				add_character_modifier = {
					name = donated_to_holy_order
					duration = -1
				}
			}

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_immortals = {
					holder_scope = {
						character_event = {
							id = SoA.1840
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.1
		}
	}

	expel_zealots = {
		ai = no
		only_independent = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_zealots
			religion = d_zealots
			higher_real_tier_than = DUKE
			NOT = { has_character_modifier = expelled_d_zealots }

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_zealots
						is_vassal_or_below_of = d_zealots
					}
				}
			}
		}

		allow = {
			piety > 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_zealots_check }
			}
		}

		effect = {
			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b

				set_character_flag = expel_zealots_check
				character_event = { id = SoA.2990 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	donate_money_to_the_zealots = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_zealots
			religion = d_zealots

			trigger_if = {
				limit = { ai = yes }

				wealth > 1000
				piety < 50
				NOT = { trait = cynical }
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_zealots
				is_liege_of = d_zealots
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			if = {
				limit = {
					NOT = { has_character_modifier = donated_to_holy_order }
				}

				add_character_modifier = {
					name = donated_to_holy_order
					duration = -1
				}
			}

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_zealots = {
					holder_scope = {
						character_event = {
							id = SoA.1940
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.1
		}
	}

	expel_sky_lords = {
		ai = no
		only_independent = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_sky_lords
			religion = d_sky_lords
			higher_real_tier_than = DUKE
			NOT = { has_character_modifier = expelled_d_sky_lords }

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_sky_lords
						is_vassal_or_below_of = d_sky_lords
					}
				}
			}

		}

		allow = {
			piety >= 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_sky_lords_check }
			}
		}

		effect = {
			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b

				set_character_flag = expel_sky_lords_check
				character_event = { id = SoA.2990 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	donate_money_to_sky_lords = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_sky_lords
			religion = d_sky_lords

			trigger_if = {
				limit = { ai = yes }

				wealth > 1000
				piety < 50
				NOT = { trait = cynical }
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_sky_lords
				is_liege_of = d_sky_lords
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			if = {
				limit = {
					NOT = { has_character_modifier = donated_to_holy_order }
				}
				add_character_modifier = {
					name = donated_to_holy_order
					duration = -1
				}
			}

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_sky_lords = {
					holder_scope = {
						character_event = {
							id = SoA.2040
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.1
		}
	}

	expel_spirit_guardians = {
		ai = no
		only_independent = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_spirit_guardians
			religion = d_spirit_guardians
			higher_real_tier_than = DUKE
			NOT = { has_character_modifier = expelled_d_spirit_guardians }

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_spirit_guardians
						is_vassal_or_below_of = d_spirit_guardians
					}
				}
			}
		}

		allow = {
			piety >= 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_spirit_guardians_check }
			}
		}

		effect = {
			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b

				set_character_flag = expel_spirit_guardians_check
				character_event = { id = SoA.2990 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	donate_money_to_spirit_guardians = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_spirit_guardians
			religion = d_spirit_guardians

			trigger_if = {
				limit = { ai = yes }

				wealth >= 1000
				piety < 50
				NOT = { trait = cynical }
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_spirit_guardians
				is_liege_of = d_spirit_guardians
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			if = {
				limit = {
					NOT = { has_character_modifier = donated_to_holy_order }
				}

				add_character_modifier = {
					name = donated_to_holy_order
					duration = -1
				}
			}

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_spirit_guardians = {
					holder_scope = {
						character_event = {
							id = SoA.2140
						}
					}
				}
			}
		}


		ai_will_do = {
			factor = 0.1
		}
	}

	expel_warriors_perun = {
		ai = no
		only_independent = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_warriors_perun
			religion = d_warriors_perun
			higher_real_tier_than = DUKE
			NOT = { has_character_modifier = expelled_d_warriors_perun }

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_warriors_perun
						is_vassal_or_below_of = d_warriors_perun
					}
				}
			}
		}

		allow = {
			piety >= 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_warriors_perun_check }
			}
		}

		effect = {
			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b

				set_character_flag = expel_warriors_perun_check
				character_event = { id = SoA.2990 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	donate_money_to_warriors_perun = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_warriors_perun
			religion = d_warriors_perun

			trigger_if = {
				limit = { ai = yes }

				wealth >= 1000
				piety < 50
				NOT = { trait = cynical }
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_warriors_perun
				is_liege_of = d_warriors_perun
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			if = {
				limit = {
					NOT = { has_character_modifier = donated_to_holy_order }
				}

				add_character_modifier = {
					name = donated_to_holy_order
					duration = -1
				}
			}

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_warriors_perun = {
					holder_scope = {
						character_event = {
							id = SoA.2240
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.1
		}
	}

	expel_chosen_perkunas = {
		ai = no

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_chosen_perkunas
			independent = yes
			higher_real_tier_than = DUKE
			religion = d_chosen_perkunas
			NOT = { has_character_modifier = expelled_d_chosen_perkunas }

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_chosen_perkunas
						is_vassal_or_below_of = d_chosen_perkunas
					}
				}
			}
		}

		allow = {
			piety >= 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_chosen_perkunas_check }
			}
		}

		effect = {
			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b

				set_character_flag = expel_chosen_perkunas_check
				character_event = { id = SoA.2990 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	donate_money_to_chosen_perkunas = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_chosen_perkunas
			religion = d_chosen_perkunas

			trigger_if = {
				limit = { ai = yes }

				wealth >= 1000
				piety < 50
				NOT = { trait = cynical }
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_chosen_perkunas
				is_liege_of = d_chosen_perkunas
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			if = {
				limit = {
					NOT = { has_character_modifier = donated_to_holy_order }
				}

				add_character_modifier = {
					name = donated_to_holy_order
					duration = -1
				}
			}

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_chosen_perkunas = {
					holder_scope = {
						character_event = {
							id = SoA.2340
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.1
		}
	}

	expel_sons_kaleva = {
		ai = no

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_sons_kaleva
			independent = yes
			higher_real_tier_than = DUKE
			religion = d_sons_kaleva
			NOT = { has_character_modifier = expelled_d_sons_kaleva }

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_sons_kaleva
						is_vassal_or_below_of = d_sons_kaleva
					}
				}
			}
		}

		allow = {
			piety >= 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_sons_kaleva_check }
			}
		}

		effect = {
			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b

				set_character_flag = expel_sons_kaleva_check
				character_event = { id = SoA.2990 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	donate_money_to_sons_kaleva = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_sons_kaleva
			religion = finnish_pagan_reformed

			trigger_if = {
				limit = { ai = yes }

				wealth >= 1000
				piety < 50
				NOT = { trait = cynical }
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_sons_kaleva
				is_liege_of = d_sons_kaleva
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			if = {
				limit = {
					NOT = { has_character_modifier = donated_to_holy_order }
				}

				add_character_modifier = {
					name = donated_to_holy_order
					duration = -1
				}
			}

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_sons_kaleva = {
					holder_scope = {
						character_event = {
							id = SoA.2440
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.1
		}
	}

	expel_huitzilopochtli = {
		ai = no
		only_independent = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_huitzilopochtli
			religion = d_huitzilopochtli
			higher_real_tier_than = DUKE
			NOT = { has_character_modifier = expelled_d_huitzilopochtli }

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_huitzilopochtli
						is_vassal_or_below_of = d_huitzilopochtli
					}
				}
			}

		}

		allow = {
			piety >= 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_huitzilopochtli_check }
			}
		}

		effect = {
			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b

				set_character_flag = expel_huitzilopochtli_check
				character_event = { id = SoA.2990 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	donate_money_to_huitzilopochtli = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_huitzilopochtli
			religion = d_huitzilopochtli

			trigger_if = {
				limit = { ai = yes }

				wealth >= 1000
				piety < 50
				NOT = { trait = cynical }
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_huitzilopochtli
				is_liege_of = d_huitzilopochtli
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			if = {
				limit = {
					NOT = { has_character_modifier = donated_to_holy_order }
				}

				add_character_modifier = {
					name = donated_to_holy_order
					duration = -1
				}
			}

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_huitzilopochtli = {
					holder_scope = {
						character_event = {
							id = SoA.2540
						}
					}
				}
			}
		}


		ai_will_do = {
			factor = 0.1
		}
	}

	expel_knights_santiago = {
		ai = no
		only_independent = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_knights_santiago
			religion = d_knights_santiago
			higher_real_tier_than = DUKE
			NOT = { has_character_modifier = expelled_d_knights_santiago }

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_knights_santiago
						is_vassal_or_below_of = d_knights_santiago
					}
				}
			}

		}

		allow = {
			piety >= 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_knights_santiago_check }
			}
		}

		effect = {
			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b

				set_character_flag = expel_knights_santiago_check
				character_event = { id = SoA.2990 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	donate_money_to_knights_santiago = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_knights_santiago
			religion = d_knights_santiago

			trigger_if = {
				limit = { ai = yes }

				wealth >= 1000
				piety < 50
				NOT = { trait = cynical }
			}

			trigger_if = {
				limit = {
					NOR = {
						culture_group = iberian
						culture_group = west_african
						culture = maghreb_arabic
						culture = occitan
					}
				}

				trigger_if = {
					limit = {
						NOR = {
							is_title_active = d_teutonic_order
							is_title_active = k_teutonic_state
							is_title_active = d_knights_hospitaler
							is_title_active = d_knights_templar
						}
					}

					OR = {
						culture_group = north_germanic
						culture_group = central_germanic
						culture_group = magyar
						culture_group = south_slavic
						culture_group = west_slavic
					}
				}
				trigger_else = {
					NOR = {
						is_title_active = d_knights_hospitaler
						is_title_active = d_knights_templar
					}
				}
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_knights_santiago
				is_liege_of = d_knights_santiago
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			if = {
				limit = {
					NOT = { has_character_modifier = donated_to_holy_order }
				}

				add_character_modifier = {
					name = donated_to_holy_order
					duration = -1
				}
			}

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_knights_santiago = {
					holder_scope = {
						character_event = {
							id = SoA.2640
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.1
		}
	}

	expel_knights_calatrava = {
		ai = no
		only_independent = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_knights_calatrava
			religion = d_knights_calatrava
			higher_real_tier_than = DUKE
			NOT = { has_character_modifier = expelled_d_knights_calatrava }

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_knights_calatrava
						is_vassal_or_below_of = d_knights_calatrava
					}
				}
			}
		}

		allow = {
			piety >= 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_knights_calatrava_check }
			}
		}

		effect = {
			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b

				set_character_flag = expel_knights_calatrava_check
				character_event = { id = SoA.2990 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	donate_money_to_knights_calatrava = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_knights_calatrava
			religion = d_knights_calatrava

			trigger_if = {
				limit = { ai = yes }

				wealth >= 1000
				piety < 50
				NOT = { trait = cynical }
			}

			trigger_if = {
				limit = {
					NOR = {
						culture_group = iberian
						culture_group = west_african
						culture = maghreb_arabic
						culture = occitan
					}
				}

				trigger_if = {
					limit = {
						NOR = {
							is_title_active = d_teutonic_order
							is_title_active = k_teutonic_state
							is_title_active = d_knights_hospitaler
							is_title_active = d_knights_templar
						}
					}

					OR = {
						culture_group = north_germanic
						culture_group = central_germanic
						culture_group = magyar
						culture_group = south_slavic
						culture_group = west_slavic
					}
				}
				trigger_else = {
					NOR = {
						is_title_active = d_knights_hospitaler
						is_title_active = d_knights_templar
					}
				}
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_knights_calatrava
				is_liege_of = d_knights_calatrava
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			if = {
				limit = {
					NOT = { has_character_modifier = donated_to_holy_order }
				}

				add_character_modifier = {
					name = donated_to_holy_order
					duration = -1
				}
			}

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_knights_calatrava = {
					holder_scope = {
						character_event = {
							id = SoA.2740
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.1
		}
	}

	expel_order_of_addai = {
		ai = no
		only_independent = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_saint_addai
			religion = d_saint_addai
			higher_real_tier_than = DUKE
			NOT = { has_character_modifier = expelled_d_saint_addai }

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_saint_addai
						is_vassal_or_below_of = d_saint_addai
					}
				}
			}
		}

		allow = {
			piety >= 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_order_of_addai_check }
			}
		}

		effect = {
			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b

				set_character_flag = expel_order_of_addai_check
				character_event = { id = SoA.2990 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	donate_money_to_order_of_addai = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			is_title_active = d_saint_addai
			religion = d_saint_addai

			trigger_if = {
				limit = { ai = yes }

				wealth >= 1000
				piety < 50
				NOT = { trait = cynical }
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_saint_addai
				is_liege_of = d_saint_addai
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			if = {
				limit = {
					NOT = { has_character_modifier = donated_to_holy_order }
				}

				add_character_modifier = {
					name = donated_to_holy_order
					duration = -1
				}
			}

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_saint_addai = {
					holder_scope = {
						character_event = {
							id = SoA.2840
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.1
		}
	}

	expel_zun_warriors = {
		ai = no
		only_independent = yes

		potential = {
			has_dlc = "Charlemagne"
			is_title_active = d_zun_warriors
			religion = d_zun_warriors
			higher_real_tier_than = DUKE
			NOT = { has_character_modifier = expelled_d_zun_warriors }

			any_realm_province = {
				any_province_lord = {
					OR = {
						character = d_zun_warriors
						is_vassal_or_below_of = d_zun_warriors
					}
				}
			}
		}

		allow = {
			piety >= 1000

			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip
				NOT = { has_character_flag = expel_zun_warriors_check }
			}
		}

		effect = {
			custom_tooltip = {
				text = expelling_holy_order_decision_tooltip_b

				set_character_flag = expel_zun_warriors_check
				character_event = { id = SoA.2990 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	donate_money_to_zun_warriors = {
		ai_check_interval = 80

		only_playable = yes

		potential = {
			has_dlc = "Charlemagne"
			is_title_active = d_zun_warriors
			religion = d_zun_warriors

			trigger_if = {
				limit = { ai = yes }

				wealth >= 1000
				piety < 50
				NOT = { trait = cynical }
			}

			NOR = {
				government = order_government
				has_character_modifier = expelled_d_zun_warriors
				is_liege_of = d_zun_warriors
			}
		}

		allow = {
			wealth >= 300

			custom_tooltip = {
				text = holy_order_donate_cooldown_tt
				NOT = { has_character_modifier = donate_to_holy_order_cooldown }
			}
		}

		effect = {
			wealth = -300
			piety = 100

			if = {
				limit = {
					NOT = { has_character_modifier = donated_to_holy_order }
				}

				add_character_modifier = {
					name = donated_to_holy_order
					duration = -1
				}
			}

			hidden_effect = {
				add_character_modifier = {
					modifier = donate_to_holy_order_cooldown
					years = 1
					hidden = yes
				}

				d_zun_warriors = {
					holder_scope = {
						character_event = {
							id = CM.4005
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.1
		}
	}

	form_st_anthony = {
		is_high_prio = yes
		ai_check_interval = 60

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			religion = miaphysite
			is_heretic = no
			NOT = { is_title_active = d_saint_anthony }

			OR = {
				# Prevent Army from being created at start
				has_global_flag = christian_crusades_unlocked
				has_global_flag = pagan_ghws_unlocked
				has_global_flag = muslim_jihads_unlocked
			}

			NOT = {
				has_alternate_start_parameter = {
					key = religion_names
					value = random
				}
			}
		}

		allow = {
			num_of_holy_sites >= 1
			religion_authority >= 0.50
			piety >= 1000
			wealth >= 500
		}
		effect = {
			piety = -1000
			wealth = -500

			narrative_event = {
				id = 39810
				tooltip = evt_39810_TT
			}
		}

		ai_will_do = {
			factor = 1
		}
	}

	form_st_addai = {
		is_high_prio = yes
		ai_check_interval = 60

		only_playable = yes

		potential = {
			has_dlc = "Sons of Abraham"
			religion = nestorian
			is_heretic = no
			NOT = { is_title_active = d_saint_addai }

			OR = {
				# Prevent Army from being created at start
				has_global_flag = christian_crusades_unlocked
				has_global_flag = pagan_ghws_unlocked
				has_global_flag = muslim_jihads_unlocked
			}

			NOT = {
				has_alternate_start_parameter = {
					key = religion_names
					value = random
				}
			}
		}

		allow = {
			num_of_holy_sites >= 1
			religion_authority >= 0.50
			piety >= 1000
			wealth >= 500
		}

		effect = {
			piety = -1000
			wealth = -500

			narrative_event = {
				id = 39811
				tooltip = evt_39811_TT
			}
		}

		ai_will_do = {
			factor = 1
		}
	}

	organize_army_light = {
		is_high_prio = yes
		ai_check_interval = 60

		only_playable = yes

		potential = {
			religion = manichean
			is_female = no
			is_adult = yes
			prisoner = no

			NOT = { has_global_flag = army_light_founded }

			OR = {
				# Prevent Army from being created at start
				has_global_flag = christian_crusades_unlocked
				has_global_flag = pagan_ghws_unlocked
				has_global_flag = muslim_jihads_unlocked
			}

			NOT = {
				has_alternate_start_parameter = {
					key = religion_names
					value = random
				}
			}
		}

		allow = {
			num_of_holy_sites >= 1
			religion_authority >= 0.50
			piety >= 1000
			wealth >= 500
		}

		effect = {
			prestige = -300
			wealth = -300

			activate_title = {
				title = d_army_light
				status = yes
			}

			hidden_effect = {
				set_global_flag = army_light_founded

				create_character = {
					random_traits = yes
					religion = manichean
					culture = ROOT
					dynasty = NONE
					female = no
					age = 34
					trait = skilled_tactician
				}

				new_character = {
					grant_title = d_army_light
					set_defacto_liege = ROOT
				}
			}
		}

		ai_will_do = {
			factor = 1
		}
	}
}